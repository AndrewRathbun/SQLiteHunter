
name: Generic.Forensic.SQLiteHunter
description: |
    Hunt for SQLite files.
    
    SQLite has become the de-facto standard for storing application data,
    in many types of applications:
    
    - Web Browsers
    - Operating Systems
    - Various applications, such as iMessage, TCC etc
    
    This artifact can hunt for these artifacts in a mostly automated way.
    More info at https://github.com/Velocidex/SQLiteHunter
    
    NOTE: If you want to use this artifact on just a bunch of files already
    collected (for example the files collected using the
    Windows.KapeFiles.Targets artifact) you can use the CustomGlob parameter
    (for example set it to "/tmp/unpacked/**" to consider all files in the
    unpacked directory).
    
    

column_types:
- name: Image
  type: preview_upload

export: |
  LET SPEC <= "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"
  LET Specs <= parse_json(data=gunzip(string=base64decode(string=SPEC)))
  LET CheckHeader(OSPath) = read_file(filename=OSPath, length=12) = "SQLite forma"
  LET Bool(Value) = if(condition=Value, then="Yes", else="No")

  -- In fast mode we check the filename, then the header then run the sqlite precondition
  LET matchFilename(SourceName, OSPath) = OSPath =~ get(item=Specs.sources, field=SourceName).filename
    AND CheckHeader(OSPath=OSPath)
    AND Identify(SourceName= SourceName, OSPath= OSPath)
    AND log(message=format(format="%v matched by filename %v",
            args=[OSPath, get(item=Specs.sources, field=SourceName).filename]))

  -- If the user wanted to also upload the file, do so now
  LET MaybeUpload(OSPath) = if(condition=AlsoUpload, then=upload(file=OSPath)) OR TRUE

  LET Identify(SourceName, OSPath) = SELECT if(
    condition=CheckHeader(OSPath=OSPath),
    then={
      SELECT *
      FROM sqlite(file=OSPath, query=get(item=Specs.sources, field=SourceName).id_query)
    }) AS Hits
  FROM scope()
  WHERE if(condition=Hits[0].Check = get(item=Specs.sources, field=SourceName).id_value,
    then= log(message="%v was identified as %v",
            args=[OSPath, get(item=Specs.sources, field=SourceName).Name]),
    else=log(message="%v was not identified as %v (got %v, wanted %v)",
             args=[OSPath, get(item=Specs.sources, field=SourceName).Name, str(str=Hits),
                   get(item=Specs.sources, field=SourceName).id_value]) AND FALSE)

  LET ApplyFile(SourceName) = SELECT * FROM foreach(row={
     SELECT OSPath FROM AllFiles
     WHERE if(condition=MatchFilename,  then=matchFilename(SourceName=SourceName, OSPath=OSPath),
      else=Identify(SourceName= SourceName, OSPath= OSPath))

  }, query={
     SELECT *, OSPath FROM sqlite(
        file=OSPath, query=get(item=Specs.sources, field=SourceName).SQL)
  })

  -- Filter for matching files without sqlite checks.
  LET FilterFile(SourceName) =
     SELECT OSPath FROM AllFiles
     WHERE if(condition=MatchFilename,
              then=OSPath =~ get(item=Specs.sources, field=SourceName).filename)

  -- Build a regex for all enabled categories.
  LET all_categories = SELECT _value FROM foreach(row=["All","MacOS","Chrome","Browser","Edge","Firefox","InternetExplorer","Windows"]) WHERE get(field=_value)
  LET category_regex <= join(sep="|", array=all_categories._value)
  LET AllGlobs <= filter(list=Specs.globs, condition="x=> x.tags =~ category_regex")
  LET _ <= log(message="Globs for category %v is %v", args=[category_regex, CustomGlob || AllGlobs.glob])
  LET AllFiles <= SELECT OSPath FROM glob(globs=CustomGlob || AllGlobs.glob)
    WHERE NOT IsDir AND MaybeUpload(OSPath=OSPath)

parameters:
- name: MatchFilename
  description: |
    If set we use the filename to detect the type of sqlite file.
    When unset we use heristics (slower)
  type: bool
  default: Y

- name: CustomGlob
  description: Specify this glob to select other files

- name: DateAfter
  description: Timebox output to rows after this time.
  type: timestamp
  default: "1970-01-01T00:00:00Z"

- name: DateBefore
  description: Timebox output to rows after this time.
  type: timestamp
  default: "2100-01-01T00:00:00Z"

- name: FilterRegex
  description: Filter critical rows by this regex
  type: regex
  default: .


- name: All
  description: Select targets with category All
  type: bool
  default: Y


- name: MacOS
  description: Select targets with category MacOS
  type: bool
  default: N


- name: Chrome
  description: Select targets with category Chrome
  type: bool
  default: N


- name: Browser
  description: Select targets with category Browser
  type: bool
  default: N


- name: Edge
  description: Select targets with category Edge
  type: bool
  default: N


- name: Firefox
  description: Select targets with category Firefox
  type: bool
  default: N


- name: InternetExplorer
  description: Select targets with category InternetExplorer
  type: bool
  default: N


- name: Windows
  description: Select targets with category Windows
  type: bool
  default: N


- name: SQLITE_ALWAYS_MAKE_TEMPFILE
  type: bool
  default: Y

- name: AlsoUpload
  description: If specified we also upload the identified file.
  type: bool

sources:
- name: AllFiles
  query: |
    SELECT * FROM AllFiles


- name: iMessage_Profiles
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="iMessage_Profiles")
    SELECT timestamp(epoch=date / 1000000000 + 978307200) AS Timestamp, *
    FROM Rows
    WHERE Timestamp > DateAfter AND Timestamp < DateBefore
      AND (MessageText, RoomName) =~ FilterRegex
    


- name: Chromium Browser Autofill_Profiles
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser Autofill_Profiles")
    SELECT GUID,
      timestamp(epoch= date_modified) AS DateModified,
      timestamp(epoch= use_date) AS UseDate,
      FirstName, MiddleName, LastName, EmailAddress,
      PhoneNumber, CompanyName, StreetAddress,
      City, State, ZipCode, UseCount, OSPath
    FROM Rows
    WHERE UseDate > DateAfter AND UseDate < DateBefore
      AND (FirstName, MiddleName, LastName, EmailAddress, CompanyName, StreetAddress) =~ FilterRegex
    


- name: Chromium Browser Autofill_Masked Credit Cards
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser Autofill_Masked Credit Cards")
    SELECT * FROM Rows


- name: Chromium Browser Bookmarks
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Chromium Browser Bookmarks")
    -- Recursive function to report the details of a folder
    LET ReportFolder(Data, BaseName) = SELECT * FROM chain(a={
      -- First row emit the data about the actual folder
      SELECT BaseName + " | " + Data.name AS Name,
             timestamp(winfiletime=int(int=Data.date_added) * 10) AS DateAdded,
             timestamp(winfiletime=int(int=Data.date_last_used) * 10) AS DateLastUsed,
             Data.type AS Type,
             Data.url || ""  AS URL
      FROM scope()
    },
    b={
       -- If this folder has children recurse into it
       SELECT * FROM foreach(row={
          SELECT _value FROM items(item=Data.children)
       },  query={
          SELECT * FROM ReportFolder(Data=_value, BaseName=BaseName + " | " + Data.name)
       })
    })
    
    LET MatchingFiles = SELECT OSPath, parse_json(data=read_file(filename=OSPath)) AS Data
    FROM Rows
    
    SELECT * FROM foreach(row=MatchingFiles, query={
      SELECT * FROM chain(
      a={
        SELECT OSPath, *, "bookmark_bar" AS Type
        FROM ReportFolder(Data=Data.roots.bookmark_bar, BaseName="")
      },
      b={
        SELECT OSPath, *, "other" AS Type
        FROM ReportFolder(Data=Data.roots.other, BaseName="")
      },
      c={
        SELECT OSPath, *, "synced" AS Type
        FROM ReportFolder(Data=Data.roots.synced, BaseName="")
      })
    })
    


- name: Chromium Browser_Cookies
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser_Cookies")
    SELECT timestamp(winfiletime=(creation_utc * 10) || 0) AS CreationUTC,
           timestamp(winfiletime=(expires_utc * 10) || 0) AS ExpiresUTC,
           timestamp(winfiletime=(last_access_utc * 10) || 0) AS LastAccessUTC,
           HostKey, Name, Path,
           Bool(Value=is_secure) AS IsSecure,
           Bool(Value=is_httponly) AS IsHttpOnly,
           Bool(Value=has_expires) AS HasExpiration,
           Bool(Value=is_persistent) AS IsPersistent,
           Priority, SourcePort, OSPath
    FROM Rows
    WHERE LastAccessUTC > DateAfter AND LastAccessUTC < DateBefore
      AND (Name, Path) =~ FilterRegex
    


- name: Chromium Browser Extensions
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Chromium Browser Extensions")
    -- Resolve the message string against the Locale dict
    LET ResolveName(Message, Locale) = get(item=Locale,
          field=lowcase(string=parse_string_with_regex(regex="^__MSG_(.+)__$", string=Message).g1),
          default=Message).message || Message
    
    -- Read the manifest files
    LET ManifestData = SELECT OSPath, parse_json(data=read_file(filename=OSPath)) AS Manifest
    FROM Rows
    
    -- Find the Locale file to help with.
    LET LocaleData = SELECT *, if(condition=Manifest.default_locale, else=dict(),
         then=parse_json(data=read_file(
            filename=OSPath.Dirname + "_locales" + Manifest.default_locale + "messages.json"))) AS Locale
    FROM ManifestData
    
    LET GetIcon(Manifest) = Manifest.icons.`128` || Manifest.icons.`64` || Manifest.icons.`32` || Manifest.icons.`16`
    
    SELECT OSPath, Manifest.author.email AS Email,
      ResolveName(Message = Manifest.name, Locale=Locale) AS name,
      ResolveName(Message = Manifest.description, Locale=Locale) AS description,
      Manifest.oauth2.scopes as Scopes,
      Manifest.permissions as Permissions,
      Manifest.key as Key, if(condition=GetIcon(Manifest=Manifest),
                then=upload(file=OSPath.Dirname + GetIcon(Manifest=Manifest))) AS Image,
      Manifest AS _Manifest
    FROM LocaleData
    WHERE (name, description) =~ FilterRegex
    


- name: Chromium Browser Favicons
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser Favicons")
    SELECT ID, IconID,
      timestamp(winfiletime= (LastUpdated * 10) || 0) AS LastUpdated,
      PageURL, FaviconURL,
      upload(accessor="data",
         file=_image,
         name=format(format="Image%v.png", args=ID)) AS Image,
      OSPath as _OSPath
    FROM Rows
    WHERE LastUpdated > DateAfter AND LastUpdated < DateBefore
    


- name: Chromium Browser History_Visits
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser History_Visits")
    SELECT ID,
       timestamp(winfiletime=(visit_time * 10) || 0) AS VisitTime,
       timestamp(winfiletime=(last_visit_time * 10) || 0) AS LastVisitedTime,
       URLTitle, URL, VisitCount, TypedCount,
       if(condition=hidden =~ '1', then="Yes", else="No") AS Hidden,
       VisitID, FromVisitID,
       visit_duration / 1000000 AS VisitDurationInSeconds,
       OSPath
    FROM Rows
    WHERE VisitTime > DateAfter
      AND VisitTime < DateBefore
      AND (URLTitle, URL) =~ FilterRegex
    


- name: Chromium Browser History_Downloads
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser History_Downloads")
    LET StateLookup <= dict(`0`='In Progress', `1`='Complete', `2`="Cancelled", `3`="Interrupted", `4`="Interrupted")
    LET DangerType <= dict(`0`='Not Dangerous', `1`="Dangerous", `2`='Dangerous URL', `3`='Dangerous Content',
        `4`='Content May Be Malicious', `5`='Uncommon Content', `6`='Dangerous But User Validated',
        `7`='Dangerous Host', `8`='Potentially Unwanted', `9`='Whitelisted by Policy')
    LET InterruptReason <= dict(`0`= 'No Interrupt', `1`= 'File Error', `2`='Access Denied', `3`='Disk Full',
      `5`='Path Too Long',`6`='File Too Large', `7`='Virus', `10`='Temporary Problem', `11`='Blocked',
      `12`='Security Check Failed', `13`='Resume Error', `20`='Network Error', `21`='Operation Timed Out',
      `22`='Connection Lost', `23`='Server Down', `30`='Server Error', `31`='Range Request Error',
      `32`='Server Precondition Error', `33`='Unable to get file', `34`='Server Unauthorized',
      `35`='Server Certificate Problem', `36`='Server Access Forbidden', `37`='Server Unreachable',
      `38`='Content Length Mismatch', `39`='Cross Origin Redirect', `40`='Cancelled', `41`='Browser Shutdown',
      `50`='Browser Crashed')
    
    SELECT ID, GUID, CurrentPath, TargetPath, OriginalMIMEType, ReceivedBytes, TotalBytes,
      timestamp(winfiletime=(start_time * 10) || 0) AS StartTime,
      timestamp(winfiletime=(end_time * 10) || 0) AS EndTime,
      timestamp(winfiletime=(opened * 10) || 0) AS Opened,
      timestamp(winfiletime=(last_access_time * 10) || 0) AS LastAccessTime,
      timestamp(epoch=last_modified) AS LastModified,
      get(item=StateLookup, field=str(str=state), default="Unknown") AS State,
      get(item=DangerType, field=str(str=danger_type), default="Unknown") AS DangerType,
      get(item=InterruptReason, field=str(str=interrupt_reason), default="Unknown") AS InterruptReason,
      ReferrerURL, SiteURL, TabURL, TabReferrerURL, DownloadURL, OSPath
    FROM Rows
    WHERE LastAccessTime > DateAfter AND LastAccessTime < DateBefore
      AND (SiteURL, DownloadURL, TabURL, TabReferrerURL, ReferrerURL, DownloadURL) =~ FilterRegex
    


- name: Chromium Browser History_Keywords
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser History_Keywords")
    SELECT KeywordID, URLID,
       timestamp(winfiletime=(last_visit_time * 10) || 0) AS LastVisitedTime,
       KeywordSearchTerm, Title, URL, OSPath
    FROM Rows
    WHERE LastVisitedTime > DateAfter AND LastVisitedTime < DateBefore
      AND (Title, KeywordSearchTerm, URL) =~ FilterRegex
    


- name: Chromium Browser Media_History
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser Media_History")
    SELECT ID, URL, WatchTimeSeconds,
       Bool(Value=has_video) AS HasVideo,
       Bool(Value=has_audio) AS HasAudio,
       timestamp(winfiletime=last_updated_time_s || 0) AS LastUpdated,
       OriginID, OSPath
    FROM Rows
    WHERE LastUpdated > DateAfter AND LastUpdated < DateBefore
      AND URL =~ FilterRegex
    


- name: Chromium Browser Media_Playback Session
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser Media_Playback Session")
    SELECT ID,
      timestamp(winfiletime=last_updated_time_s || 0) AS LastUpdated, URL,
      duration_ms / 1000 AS DurationInSeconds,
      position_ms / 1000 AS PositionInSeconds,
      Title, Artist, Album, SourceTitle, OriginID, OSPath
    FROM Rows
    WHERE LastUpdated > DateAfter AND LastUpdated < DateBefore
      AND URL =~ FilterRegex
    


- name: Chromium Browser Network_Predictor
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser Network_Predictor")
    SELECT * FROM Rows
    WHERE UserText =~ FilterRegex
    


- name: Chromium Browser Notifications_Site Engagements
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Chromium Browser Notifications_Site Engagements")
    LET JSON = SELECT parse_json(data=read_file(filename=OSPath)) AS Data, OSPath FROM Rows
    
    SELECT * FROM foreach(row={
      SELECT OSPath, Data.profile.content_settings.exceptions AS exceptions FROM JSON
    },  query={
      SELECT _key AS Site,
         timestamp(winfiletime=int(int=_value.last_modified) * 10 || 0) AS LastModified,
         timestamp(winfiletime=int(int=_value.setting.lastEngagementTime) * 10 || 0) AS LastEngagementTime,
         OSPath
      FROM items(item=exceptions.site_engagement)
    })
    


- name: Chromium Browser Notifications_App Banners
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Chromium Browser Notifications_App Banners")
    LET JSON = SELECT parse_json(data=read_file(filename=OSPath)) AS Data, OSPath FROM Rows
    
    SELECT * FROM foreach(row={
      SELECT OSPath, Data.profile.content_settings.exceptions AS exceptions FROM JSON
    },  query={
      SELECT _key AS Site,
         timestamp(winfiletime=int(int=_value.last_modified) * 10 || 0) AS LastModified,
         {
           SELECT _key AS Site,
              timestamp(winfiletime=int(int=_value.couldShowBannerEvents) * 10 || 0) AS CouldShowBannerEvents,
              timestamp(winfiletime=int(int=_value.next_install_text_animation.last_shown) * 10 || 0) AS LastShown
           FROM items(item=_value.setting)
         } AS Setting,
         OSPath
      FROM items(item=exceptions.app_banner)
    })
    


- name: Chromium Browser Notifications_Notification Preferences
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Chromium Browser Notifications_Notification Preferences")
    LET ContentSettings <= array(`0`="Default",`1`="Allow",`2`="Block",`3`="Ask",`4`="Session Only",`5`="Detect Important Content")
    
    LET JSON = SELECT parse_json(data=read_file(filename=OSPath)) AS Data, OSPath FROM Rows
    
    SELECT * FROM foreach(row={
      SELECT OSPath, Data.profile.content_settings.exceptions AS exceptions FROM JSON
    },  query={
      SELECT _key AS Site,
        timestamp(winfiletime=int(int=_value.last_modified) * 10 || 0) AS LastModified,
        ContentSettings[_value.setting] AS Setting,
        OSPath
      FROM items(item=exceptions.notifications)
    })
    


- name: Chromium Browser Notifications_Notification Interactions
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Chromium Browser Notifications_Notification Interactions")
    LET JSON = SELECT parse_json(data=read_file(filename=OSPath)) AS Data, OSPath FROM Rows
    LET S = scope()
    
    SELECT * FROM foreach(row={
      SELECT OSPath, Data.profile.content_settings.exceptions AS exceptions FROM JSON
    },  query={
      SELECT _key AS URL,
        timestamp(winfiletime=int(int=_value.last_modified) * 10 || 0) AS LastModified,
        _value.display_count as DisplayCount,
        _value.click_count as ClickCount,
        OSPath
      FROM items(item=S.notification_interactions || dict())
    })
    


- name: Chromium Browser Shortcuts
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser Shortcuts")
    SELECT ID,
      timestamp(winfiletime= (last_access_time * 10) || 0) AS LastAccessTime,
      TextTyped, FillIntoEdit, URL, Contents,
      Description, Type, Keyword, TimesSelectedByUser, OSPath
    FROM Rows
    WHERE LastAccessTime > DateAfter AND LastAccessTime < DateBefore
      AND (Contents, Description) =~ FilterRegex
    


- name: Chromium Sessions_Sessions
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Sessions_Sessions")
    SELECT timestamp(winfiletime=(creation_utc * 10) || 0) AS CreationUTC,
           timestamp(winfiletime=(expires_utc * 10) || 0) AS ExpiresUTC,
           timestamp(winfiletime=(last_access_utc * 10) || 0) AS LastAccessUTC,
           HostKey, Name, Path,
           Bool(Value=is_secure) AS IsSecure,
           Bool(Value=is_httponly) AS IsHttpOnly,
           Bool(Value=has_expires) AS HasExpiration,
           Bool(Value=is_persistent) AS IsPersistent,
           Priority, SourcePort, OSPath
    FROM Rows
    WHERE LastAccessUTC > DateAfter AND LastAccessUTC < DateBefore
      AND (Name, Path) =~ FilterRegex
    


- name: Chromium Browser Top Sites
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Chromium Browser Top Sites")
    SELECT * FROM Rows
    WHERE ( URL =~ FilterRegex OR Title =~ FilterRegex )
    


- name: Edge Browser Navigation History_Navigation History
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Edge Browser Navigation History_Navigation History")
    SELECT ID,
       timestamp(epoch=`Last Visited Time`) AS `Last Visited Time`,
       Title, URL, VisitCount, OSPath
    FROM Rows
    WHERE `Last Visited Time` > DateAfter
      AND `Last Visited Time` < DateBefore
      AND (Title, URL) =~ FilterRegex
    


- name: Firefox Places
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Firefox Places")
    LET BookmarkTypes <= dict(`1`="URL", `2`="Folder", `3`="Separator")
    SELECT ID, ParentID,
       get(item= BookmarkTypes, field=str(str=type), default="Unknown") AS Type,
       timestamp(epoch=dateAdded) AS DateAdded,
       timestamp(epoch=lastModified) AS LastModified,
       Position, Title, URL, ForeignKey, OSPath
    FROM Rows
    WHERE LastModified > DateAfter AND LastModified < DateBefore
      AND (Title, URL) =~ FilterRegex
    


- name: Firefox Places_Downloads
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Firefox Places_Downloads")
    SELECT PlaceID, Content,
       timestamp(epoch=dateAdded) AS DateAdded,
       timestamp(epoch=lastModified) AS LastModified,
       OSPath
    FROM Rows
    WHERE LastModified > DateAfter AND LastModified < DateBefore
      AND Content =~ FilterRegex
    


- name: Firefox Places_History
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Firefox Places_History")
    LET VisitType <= dict(`1`='TRANSITION_LINK', `2`='TRANSITION_TYPED', `3`='TRANSITION_BOOKMARK',
      `4`='TRANSITION_EMBED', `5`= 'TRANSITION_REDIRECT_PERMANENT', `6`='TRANSITION_REDIRECT_TEMPORARY',
      `7`='TRANSITION_DOWNLOAD', `8`='TRANSITION_FRAMED_LINK', `9`='TRANSITION_RELOAD')
    
    SELECT VisitID, FromVisitID,
       timestamp(epoch= last_visit_date) AS LastVisitDate,
       VisitCount, URL, Title, Description,
       get(item= VisitType, field=str(str=visit_type), default="Unknown") AS VisitType,
       Bool(Value=hidden) AS Hidden,
       Bool(Value=typed) AS Typed,
       Frecency, PreviewImageURL, OSPath
    FROM Rows
    WHERE LastVisitDate > DateAfter AND LastVisitDate < DateBefore
      AND (Title, URL, Description) =~ FilterRegex
    


- name: Firefox Cookies
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Firefox Cookies")
    SELECT ID, Host, Name, Value,
       timestamp(epoch= creationTime) AS CreationTime,
       timestamp(epoch= lastAccessed) AS LastAccessedTime,
       timestamp(epoch= expiry) AS Expiration,
       Bool(Value= isSecure) AS IsSecure,
       Bool(Value= isHttpOnly) AS IsHTTPOnly, OSPath
    FROM Rows
    WHERE LastAccessedTime > DateAfter
      AND LastAccessedTime < DateBefore
      AND ( Name =~ FilterRegex OR Value =~ FilterRegex )
    


- name: Firefox Downloads
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Firefox Downloads")
    SELECT ID, Name, MIMEType, Source, Target,
       timestamp(epoch= startTime) AS StartTime,
       timestamp(epoch= endTime) AS EndTime,
       timestamp(epoch= expiry) AS Expiration,
       CurrentBytes, MaxBytes, OSPath
    FROM Rows
    WHERE StartTime > DateAfter
      AND StartTime < DateBefore
      AND Name =~ FilterRegex
    


- name: Firefox Favicons
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Firefox Favicons")
    SELECT ID, PageURL, FaviconURL,
       timestamp(epoch= expire_ms) AS Expiration,
       OSPath
    FROM Rows
    


- name: Firefox Form History
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Firefox Form History")
    SELECT ID, FieldName, Value, TimesUsed,
       timestamp(epoch= firstUsed) AS FirstUsed,
       timestamp(epoch= lastUsed) AS LastUsed,
       GUID, OSPath
    FROM Rows
    WHERE LastUsed > DateAfter AND LastUsed < DateBefore
      AND ( FieldName =~ FilterRegex OR Value =~ FilterRegex )
    


- name: IE or Edge WebCacheV01_All Data
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="IE or Edge WebCacheV01_All Data")
    LET MatchingFiles = SELECT OSPath FROM Rows
    
    LET Containers(OSPath) = SELECT Table
    FROM parse_ese_catalog(file=OSPath)
    WHERE Table =~ "Container_"
    GROUP BY Table
    
    LET AllHits(OSPath) = SELECT * FROM foreach(row={
        SELECT * FROM Containers(OSPath=OSPath)
    }, query={
       SELECT timestamp(winfiletime=ExpiryTime) AS ExpiryTime,
          timestamp(winfiletime=ModifiedTime) AS ModifiedTime,
          timestamp(winfiletime=AccessedTime) AS AccessedTime, Url, *
       FROM parse_ese(file=OSPath, table=Table)
    })
    
    SELECT * FROM foreach(row=MatchingFiles, query={
      SELECT * FROM AllHits(OSPath=OSPath)
    })
    WHERE AccessedTime > DateAfter AND AccessedTime < DateBefore
      AND Url =~ FilterRegex
    


- name: IE or Edge WebCacheV01_Highlights
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="IE or Edge WebCacheV01_Highlights")
    SELECT * FROM foreach(row=MatchingFiles, query={
      SELECT AccessedTime, ModifiedTime, ExpiryTime, Url
      FROM AllHits(OSPath=OSPath)
    })
    WHERE AccessedTime > DateAfter AND AccessedTime < DateBefore
      AND Url =~ FilterRegex
    


- name: MacOS Applications Cache
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="MacOS Applications Cache")
    SELECT
       time_stamp AS Timestamp,
       OSPath.Base AS Application,
       entry_ID AS EntryID,
       version AS Version,
       hash_value AS Hash,
       storage_policy AS StoragePolicy,
       request_key AS URL,
       plist(file=request_object, accessor="data") AS Request,
       plist(file=response_object, accessor="data") AS Response,
       partition AS Partition,
       OSPath
    FROM Rows
    WHERE Timestamp > DateAfter AND Timestamp < DateBefore
      AND Application =~ FilterRegex
    


- name: MacOS NetworkUsage
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="MacOS NetworkUsage")
    SELECT timestamp(epoch= ZTIMESTAMP + 978307200) AS Timestamp,
      timestamp(epoch= ZFIRSTTIMESTAMP + 978307200) AS FirstTimestamp,
      timestamp(epoch= LIVE_USAGE_TIMESTAMP + 978307200) AS LiveUsageTimestamp,
      ZBUNDLENAME AS BundleID,
      ZPROCNAME AS ProcessName,
      ZWIFIIN AS WifiIn,
      ZWIFIOUT AS WifiOut,
      ZWWANIN AS WanIn,
      ZWWANOUT AS WandOut,
      ZWIREDIN AS WiredIn,
      ZWIREDOUT AS WiredOut,
      ZXIN AS _XIn,
      ZXOUT AS _XOut,
      Z_PK AS LiveUsageTableID
    FROM Rows
    


- name: MacOS Notes
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="MacOS Notes")
    SELECT Key AS _Key,
     OSPath[1] AS User,
     Note,
     Title,
     Snippet,
     NoteID AS _NoteID,
     timestamp(cocoatime=CreatedTS) AS CreatedTime,
     timestamp(cocoatime=LastOpenedDate) AS LastOpenedTime,
     timestamp(cocoatime=DirModificationDate) AS LastDirModifcation,
     Account AS _Account,
     Directory,
     DirectoryID,
     AttachmentName,
     AttachmentSize,
     AttachmentUUID,
     if(condition=AttachmentUUID,
        then=OSPath[:2] + '/Library/Group Containers/group.com.apple.notes/Accounts/LocalAccount/Media/' + AttachmentUUID + '/' + AttachmentName) AS AttachmentLocation,
     AccountName AS _AccountName,
     AccountID AS _AccountID,
     AccountType AS _AccountType,
     gunzip(string=Data) AS Data,
     OSPath
    FROM Rows
    WHERE LastOpenedTime > DateAfter AND LastOpenedTime < DateBefore
      AND ( Title =~ FilterRegex OR Data =~ FilterRegex )
    


- name: Windows Activities Cache_ActivityPackageId
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Windows Activities Cache_ActivityPackageId")
    SELECT format(format="%0X-%0X-%0X-%0X-%0X", args=[
      ActivityId[0:4], ActivityId[4:6], ActivityId[6:8],
      ActivityId[8:10], ActivityId[10:] ]) AS ActivityId,
      Platform, PackageName, ExpirationTime, OSPath
    FROM Rows
    


- name: Windows Activities Cache_Clipboard
  query: |
    LET Rows = SELECT * FROM ApplyFile(SourceName="Windows Activities Cache_Clipboard")
    SELECT
      CreatedTime,
      timestamp(epoch=LastModifiedTime) AS LastModifiedTime,
      timestamp(epoch=LastModifiedOnClient) AS LastModifiedOnClient,
      StartTime,
      EndTime,
      Payload,
      OSPath[1] AS User,
      base64decode(string=parse_json_array(data=ClipboardPayload)[0].content) AS ClipboardPayload,
      OSPath AS Path,
      Mtime
    FROM Rows
    WHERE StartTime > DateAfter
      AND StartTime < DateBefore
      AND ClipboardPayload =~ FilterRegex
    


- name: Windows Search Service_SystemIndex_Gthr
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Windows Search Service_SystemIndex_Gthr")
    LET MatchingFiles = SELECT OSPath FROM Rows
    
    LET FormatTimeB(T) = timestamp(winfiletime=parse_binary(
       filename=T, accessor="data", struct="uint64b"))
    
    LET FormatTime(T) = timestamp(winfiletime=parse_binary(
       filename=T, accessor="data", struct="uint64"))
    
    LET FormatSize(T) = parse_binary(
       filename=T, accessor="data", struct="uint64")
    
    SELECT * FROM foreach(row=MatchingFiles, query={
       SELECT ScopeID, DocumentID, SDID,
          FormatTimeB(T=LastModified) AS LastModified,
          FileName
       FROM parse_ese(file=OSPath, table= "SystemIndex_Gthr")
    })
    WHERE LastModified > DateAfter AND LastModified < DateBefore
      AND FileName =~ FilterRegex
    


- name: Windows Search Service_SystemIndex_GthrPth
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Windows Search Service_SystemIndex_GthrPth")
    SELECT * FROM foreach(row=MatchingFiles, query={
       SELECT Scope, Parent, Name
       FROM parse_ese(file=OSPath, table= "SystemIndex_GthrPth")
    })
    WHERE Name =~ FilterRegex
    


- name: Windows Search Service_SystemIndex_PropertyStore
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Windows Search Service_SystemIndex_PropertyStore")
    LET X = scope()
    
    -- The PropertyStore columns look like
    -- <random>-ProperName so we strip the
    -- random part off to display it properly.
    LET FilterDict(Dict) = to_dict(item={
      SELECT split(sep_string="-", string=_key)[1] || _key AS _key, _value
      FROM items(item=Dict)
    })
    
    LET PropStore(OSPath) = SELECT *,
       FormatTime(T=X.System_Search_GatherTime) AS System_Search_GatherTime,
       FormatSize(T=X.System_Size) AS System_Size,
       FormatTime(T=X.System_DateModified) AS System_DateModified,
       FormatTime(T=X.System_DateAccessed) AS System_DateAccessed,
       FormatTime(T=X.System_DateCreated) AS System_DateCreated
    FROM foreach(row={
       SELECT *, FilterDict(Dict=_value) AS _value
       FROM items(item={
         SELECT * FROM parse_ese(file=OSPath, table="SystemIndex_PropertyStore")
      })
    }, column="_value")
    
    SELECT * FROM foreach(row=MatchingFiles, query={
       SELECT *
       FROM PropStore(OSPath=OSPath)
    })
    WHERE System_DateAccessed > DateAfter AND System_DateAccessed < DateBefore
    


- name: Windows Search Service_SystemIndex_PropertyStore_Highlights
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Windows Search Service_SystemIndex_PropertyStore_Highlights")
    SELECT * FROM foreach(row=MatchingFiles, query={
       SELECT WorkID,
          System_Search_GatherTime,
          System_Size,
          System_DateModified,
          System_DateCreated,
          X.System_FileOwner AS System_FileOwner,
          X.System_ItemPathDisplay AS System_ItemPathDisplay,
          X.System_ItemType AS System_ItemType,
          X.System_FileAttributes AS System_FileAttributes,
          X.System_Search_AutoSummary AS System_Search_AutoSummary
       FROM PropStore(OSPath=OSPath)
    })
    WHERE System_DateAccessed > DateAfter AND System_DateAccessed < DateBefore
    


- name: Windows Search Service_BrowsingActivity
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Windows Search Service_BrowsingActivity")
    SELECT * FROM foreach(row=MatchingFiles, query={
       SELECT X.ItemPathDisplay AS ItemPathDisplay,
          X.Activity_ContentUri AS Activity_ContentUri,
          X.Activity_Description AS Activity_Description
       FROM PropStore(OSPath=OSPath)
       WHERE Activity_ContentUri
    })
    


- name: Windows Search Service_UserActivityLogging
  query: |
    LET Rows = SELECT * FROM FilterFile(SourceName="Windows Search Service_UserActivityLogging")
    SELECT * FROM foreach(row=MatchingFiles, query={
       SELECT X.System_ItemPathDisplay AS System_ItemPathDisplay,
           FormatTime(T=X.ActivityHistory_StartTime) AS ActivityHistory_StartTime,
           FormatTime(T=X.ActivityHistory_EndTime) AS ActivityHistory_EndTime,
           X.ActivityHistory_AppId AS ActivityHistory_AppId
       FROM PropStore(OSPath=OSPath)
       WHERE ActivityHistory_AppId
    })
    WHERE ActivityHistory_StartTime > DateAfter
      AND ActivityHistory_StartTime < DateBefore
    



